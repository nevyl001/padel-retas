{"ast":null,"code":"import{updatePair,getPairs,getMatches,getGames}from\"../lib/database\";export class MatchResultCalculator{/**\n   * Calcula estadísticas de un partido específico\n   */static calculateMatchStatistics(match,games){console.log(\"🎯 === CÁLCULO DE ESTADÍSTICAS DEL PARTIDO ===\");console.log(\"🎯 Partido ID:\",match.id);console.log(\"🎯 Total de juegos:\",games.length);let pair1GamesWon=0;let pair2GamesWon=0;let pair1TotalPoints=0;let pair2TotalPoints=0;let pair1SetsWon=0;let pair2SetsWon=0;// Procesar cada juego del partido\ngames.forEach((game,index)=>{console.log(`📊 === JUEGO ${index+1} ===`);console.log(\"📊 Datos del juego:\",{pair1_games:game.pair1_games,pair2_games:game.pair2_games,is_tie_break:game.is_tie_break,tie_break_pair1:game.tie_break_pair1_points,tie_break_pair2:game.tie_break_pair2_points});if(game.is_tie_break){console.log(\"📊 Es un tie-break\");// Para tie-breaks\nif(game.tie_break_pair1_points>game.tie_break_pair2_points){pair1GamesWon++;console.log(`✅ Pareja 1 gana tie-break: ${game.tie_break_pair1_points}-${game.tie_break_pair2_points}`);}else if(game.tie_break_pair2_points>game.tie_break_pair1_points){pair2GamesWon++;console.log(`✅ Pareja 2 gana tie-break: ${game.tie_break_pair1_points}-${game.tie_break_pair2_points}`);}else{console.log(`🤝 Empate en tie-break: ${game.tie_break_pair1_points}-${game.tie_break_pair2_points}`);}pair1TotalPoints+=game.tie_break_pair1_points||0;pair2TotalPoints+=game.tie_break_pair2_points||0;}else{console.log(\"📊 Es un juego normal\");console.log(`📊 Puntos Pareja 1: ${game.pair1_games}, Puntos Pareja 2: ${game.pair2_games}`);// Para juegos normales\nif(game.pair1_games>game.pair2_games){pair1GamesWon++;console.log(`✅ Pareja 1 gana juego: ${game.pair1_games}-${game.pair2_games}`);}else if(game.pair2_games>game.pair1_games){pair2GamesWon++;console.log(`✅ Pareja 2 gana juego: ${game.pair1_games}-${game.pair2_games}`);}else{console.log(`🤝 Empate en juego: ${game.pair1_games}-${game.pair2_games}`);}pair1TotalPoints+=game.pair1_games;pair2TotalPoints+=game.pair2_games;}// Verificar si alguna pareja llegó a 6 puntos en este juego (gana 1 set)\nif(!game.is_tie_break){if(game.pair1_games>=6){pair1SetsWon++;console.log(`🏆 Pareja 1 gana 1 SET en juego ${index+1} con ${game.pair1_games} puntos`);}if(game.pair2_games>=6){pair2SetsWon++;console.log(`🏆 Pareja 2 gana 1 SET en juego ${index+1} con ${game.pair2_games} puntos`);}}console.log(`📊 Después del juego ${index+1}: Pareja 1 = ${pair1GamesWon} juegos, Pareja 2 = ${pair2GamesWon} juegos`);});console.log(\"🔍 === RESULTADO FINAL DEL PARTIDO ===\");console.log(`🔍 Juegos: Pareja 1 = ${pair1GamesWon}, Pareja 2 = ${pair2GamesWon}`);console.log(`🔍 Sets: Pareja 1 = ${pair1SetsWon}, Pareja 2 = ${pair2SetsWon}`);console.log(`🔍 Puntos totales: Pareja 1 = ${pair1TotalPoints}, Pareja 2 = ${pair2TotalPoints}`);// Determinar si es empate (cuando los puntos totales son iguales)\nconst isTie=pair1TotalPoints===pair2TotalPoints;console.log(`🔍 Es empate: ${isTie} (${pair1TotalPoints}-${pair2TotalPoints} puntos totales)`);console.log(\"🎯 === FIN CÁLCULO DEL PARTIDO ===\");return{pair1GamesWon,pair2GamesWon,pair1SetsWon,pair2SetsWon,pair1TotalPoints,pair2TotalPoints,isTie};}/**\n   * SOLO recalcula estadísticas del partido (sin acumular)\n   * Se usa cuando se corrige un juego\n   */static async recalculateMatchStatistics(match,games,pairs){try{console.log(\"🔄 === RECÁLCULO DE ESTADÍSTICAS DEL PARTIDO ===\");console.log(\"🔄 SOLO recálculo - NO acumula estadísticas\");const stats=this.calculateMatchStatistics(match,games);const pair1=pairs.find(p=>p.id===match.pair1_id);const pair2=pairs.find(p=>p.id===match.pair2_id);console.log(\"📊 Estadísticas recalculadas del partido:\",{pair1GamesWon:stats.pair1GamesWon,pair2GamesWon:stats.pair2GamesWon,pair1SetsWon:stats.pair1SetsWon,pair2SetsWon:stats.pair2SetsWon,isTie:stats.isTie});// NO actualizar estadísticas en la base de datos\n// Solo calcular para mostrar en la interfaz\nconsole.log(\"✅ Solo recálculo completado - NO se actualizaron estadísticas\");// Determinar ganador del partido\nlet winnerId;console.log(\"🏆 === DETERMINACIÓN DEL GANADOR DEL PARTIDO ===\");console.log(`🏆 Sets: Pareja 1 = ${stats.pair1SetsWon}, Pareja 2 = ${stats.pair2SetsWon}`);console.log(`🏆 Juegos: Pareja 1 = ${stats.pair1GamesWon}, Pareja 2 = ${stats.pair2GamesWon}`);console.log(`🏆 Es empate: ${stats.isTie}`);if(stats.isTie){winnerId=undefined;console.log(\"🤝 Partido terminó en EMPATE por puntos totales\");}else if(stats.pair1TotalPoints>stats.pair2TotalPoints){winnerId=match.pair1_id;console.log(\"🏆 Pareja 1 gana por puntos totales\");}else if(stats.pair2TotalPoints>stats.pair1TotalPoints){winnerId=match.pair2_id;console.log(\"🏆 Pareja 2 gana por puntos totales\");}else{winnerId=undefined;console.log(\"❌ Caso inesperado en determinación del ganador\");}let message;if(stats.isTie){message=`✅ Partido recalculado.\\n\\n🤝 EMPATE (${stats.pair1TotalPoints}-${stats.pair2TotalPoints} puntos totales)`;}else if(winnerId){var _pair1$player,_pair1$player2,_pair2$player,_pair2$player2;const winnerName=winnerId===match.pair1_id?`${pair1===null||pair1===void 0?void 0:(_pair1$player=pair1.player1)===null||_pair1$player===void 0?void 0:_pair1$player.name} y ${pair1===null||pair1===void 0?void 0:(_pair1$player2=pair1.player2)===null||_pair1$player2===void 0?void 0:_pair1$player2.name}`:`${pair2===null||pair2===void 0?void 0:(_pair2$player=pair2.player1)===null||_pair2$player===void 0?void 0:_pair2$player.name} y ${pair2===null||pair2===void 0?void 0:(_pair2$player2=pair2.player2)===null||_pair2$player2===void 0?void 0:_pair2$player2.name}`;message=`✅ Partido recalculado.\\n\\n🏆 Ganador: ${winnerName} (${stats.pair1TotalPoints}-${stats.pair2TotalPoints} puntos totales)`;}else{message=`✅ Partido recalculado.\\n\\n🤝 Empate (${stats.pair1TotalPoints}-${stats.pair2TotalPoints} puntos totales)`;}console.log(\"🔄 === FIN RECÁLCULO DEL PARTIDO ===\");return{success:true,message,pair1Stats:{gamesWon:stats.pair1GamesWon,setsWon:stats.pair1SetsWon,points:stats.pair1TotalPoints},pair2Stats:{gamesWon:stats.pair2GamesWon,setsWon:stats.pair2SetsWon,points:stats.pair2TotalPoints},winnerId,isTie:stats.isTie};}catch(error){console.error(\"❌ Error en recalculateMatchStatistics:\",error);return{success:false,message:\"Error al recalcular estadísticas del partido\",pair1Stats:{gamesWon:0,setsWon:0,points:0},pair2Stats:{gamesWon:0,setsWon:0,points:0},isTie:false};}}/**\n   * ACUMULA estadísticas del partido a las estadísticas totales\n   * Se usa SOLO cuando se finaliza el partido\n   */static async accumulateMatchStatistics(match,games,pairs){try{console.log(\"🏆 === ACUMULACIÓN DE ESTADÍSTICAS DEL PARTIDO ===\");console.log(\"🏆 ACUMULANDO estadísticas al finalizar partido\");const stats=this.calculateMatchStatistics(match,games);const pair1=pairs.find(p=>p.id===match.pair1_id);const pair2=pairs.find(p=>p.id===match.pair2_id);console.log(\"📊 Estadísticas del partido a acumular:\",{pair1GamesWon:stats.pair1GamesWon,pair2GamesWon:stats.pair2GamesWon,pair1SetsWon:stats.pair1SetsWon,pair2SetsWon:stats.pair2SetsWon,isTie:stats.isTie});// ACUMULAR estadísticas en la base de datos\nif(pair1){var _pair1$player3,_pair1$player4;console.log(`📊 Acumulando Pareja 1: ${(_pair1$player3=pair1.player1)===null||_pair1$player3===void 0?void 0:_pair1$player3.name} y ${(_pair1$player4=pair1.player2)===null||_pair1$player4===void 0?void 0:_pair1$player4.name}`);console.log(`📊 Estadísticas actuales: ${pair1.games_won} juegos, ${pair1.sets_won} sets, ${pair1.points} puntos, ${pair1.matches_played} partidos`);console.log(`📊 Estadísticas del partido: ${stats.pair1GamesWon} juegos, ${stats.pair1SetsWon} sets, ${stats.pair1TotalPoints} puntos`);await updatePair(pair1.id,{games_won:pair1.games_won+stats.pair1GamesWon,sets_won:pair1.sets_won+stats.pair1SetsWon,points:pair1.points+stats.pair1TotalPoints,matches_played:pair1.matches_played+1});console.log(`✅ Pareja 1 acumulada: ${pair1.games_won+stats.pair1GamesWon} juegos, ${pair1.sets_won+stats.pair1SetsWon} sets, ${pair1.points+stats.pair1TotalPoints} puntos, ${pair1.matches_played+1} partidos`);}if(pair2){var _pair2$player3,_pair2$player4;console.log(`📊 Acumulando Pareja 2: ${(_pair2$player3=pair2.player1)===null||_pair2$player3===void 0?void 0:_pair2$player3.name} y ${(_pair2$player4=pair2.player2)===null||_pair2$player4===void 0?void 0:_pair2$player4.name}`);console.log(`📊 Estadísticas actuales: ${pair2.games_won} juegos, ${pair2.sets_won} sets, ${pair2.points} puntos, ${pair2.matches_played} partidos`);console.log(`📊 Estadísticas del partido: ${stats.pair2GamesWon} juegos, ${stats.pair2SetsWon} sets, ${stats.pair2TotalPoints} puntos`);await updatePair(pair2.id,{games_won:pair2.games_won+stats.pair2GamesWon,sets_won:pair2.sets_won+stats.pair2SetsWon,points:pair2.points+stats.pair2TotalPoints,matches_played:pair2.matches_played+1});console.log(`✅ Pareja 2 acumulada: ${pair2.games_won+stats.pair2GamesWon} juegos, ${pair2.sets_won+stats.pair2SetsWon} sets, ${pair2.points+stats.pair2TotalPoints} puntos, ${pair2.matches_played+1} partidos`);}// Determinar ganador\nlet winnerId;console.log(\"🏆 === DETERMINACIÓN DEL GANADOR ===\");console.log(`🏆 Sets: Pareja 1 = ${stats.pair1SetsWon}, Pareja 2 = ${stats.pair2SetsWon}`);console.log(`🏆 Juegos: Pareja 1 = ${stats.pair1GamesWon}, Pareja 2 = ${stats.pair2GamesWon}`);console.log(`🏆 Es empate: ${stats.isTie}`);if(stats.isTie){winnerId=undefined;console.log(\"🤝 Partido terminó en EMPATE por puntos totales\");}else if(stats.pair1TotalPoints>stats.pair2TotalPoints){winnerId=match.pair1_id;console.log(\"🏆 Pareja 1 gana por puntos totales\");}else if(stats.pair2TotalPoints>stats.pair1TotalPoints){winnerId=match.pair2_id;console.log(\"🏆 Pareja 2 gana por puntos totales\");}else{winnerId=undefined;console.log(\"❌ Caso inesperado en determinación del ganador\");}let message;if(stats.isTie){message=`✅ Partido finalizado.\\n\\n🤝 EMPATE (${stats.pair1TotalPoints}-${stats.pair2TotalPoints} puntos totales)`;}else if(winnerId){var _pair1$player5,_pair1$player6,_pair2$player5,_pair2$player6;const winnerName=winnerId===match.pair1_id?`${pair1===null||pair1===void 0?void 0:(_pair1$player5=pair1.player1)===null||_pair1$player5===void 0?void 0:_pair1$player5.name} y ${pair1===null||pair1===void 0?void 0:(_pair1$player6=pair1.player2)===null||_pair1$player6===void 0?void 0:_pair1$player6.name}`:`${pair2===null||pair2===void 0?void 0:(_pair2$player5=pair2.player1)===null||_pair2$player5===void 0?void 0:_pair2$player5.name} y ${pair2===null||pair2===void 0?void 0:(_pair2$player6=pair2.player2)===null||_pair2$player6===void 0?void 0:_pair2$player6.name}`;message=`✅ Partido finalizado.\\n\\n🏆 Ganador: ${winnerName} (${stats.pair1TotalPoints}-${stats.pair2TotalPoints} puntos totales)`;}else{message=`✅ Partido finalizado.\\n\\n🤝 Empate (${stats.pair1TotalPoints}-${stats.pair2TotalPoints} puntos totales)`;}console.log(\"🏆 === FIN ACUMULACIÓN DEL PARTIDO ===\");return{success:true,message,pair1Stats:{gamesWon:stats.pair1GamesWon,setsWon:stats.pair1SetsWon,points:stats.pair1TotalPoints},pair2Stats:{gamesWon:stats.pair2GamesWon,setsWon:stats.pair2SetsWon,points:stats.pair2TotalPoints},winnerId,isTie:stats.isTie};}catch(error){console.error(\"❌ Error en accumulateMatchStatistics:\",error);return{success:false,message:\"Error al acumular estadísticas del partido\",pair1Stats:{gamesWon:0,setsWon:0,points:0},pair2Stats:{gamesWon:0,setsWon:0,points:0},isTie:false};}}/**\n   * Recalcula todas las estadísticas del torneo\n   */static async recalculateAllStatistics(tournamentId){try{console.log(\"🔄 === INICIO RECÁLCULO COMPLETO ===\");// Obtener todos los datos del torneo\nconst pairs=await getPairs(tournamentId);const matches=await getMatches(tournamentId);// Resetear todas las estadísticas de las parejas\nconsole.log(\"🔄 Reseteando estadísticas de todas las parejas...\");for(const pair of pairs){await updatePair(pair.id,{games_won:0,sets_won:0,points:0,matches_played:0});}// Crear un mapa para acumular estadísticas de cada pareja\nconst pairStats=new Map();// Inicializar estadísticas para todas las parejas\nfor(const pair of pairs){pairStats.set(pair.id,{gamesWon:0,setsWon:0,points:0,matchesPlayed:0});}// Procesar cada partido finalizado y acumular estadísticas\nlet processedMatches=0;for(const match of matches){if(match.is_finished){console.log(`🔄 Procesando partido finalizado: ${match.id}`);const games=await getGames(match.id);if(games.length>0){const stats=this.calculateMatchStatistics(match,games);// Acumular estadísticas para pareja 1\nconst pair1Stats=pairStats.get(match.pair1_id);pair1Stats.gamesWon+=stats.pair1GamesWon;pair1Stats.setsWon+=stats.pair1SetsWon;pair1Stats.points+=stats.pair1TotalPoints;pair1Stats.matchesPlayed+=1;// Acumular estadísticas para pareja 2\nconst pair2Stats=pairStats.get(match.pair2_id);pair2Stats.gamesWon+=stats.pair2GamesWon;pair2Stats.setsWon+=stats.pair2SetsWon;pair2Stats.points+=stats.pair2TotalPoints;pair2Stats.matchesPlayed+=1;processedMatches++;}}}// Actualizar todas las parejas con sus estadísticas acumuladas\nconsole.log(\"🔄 Actualizando estadísticas acumuladas...\");for(const pair of pairs){const stats=pairStats.get(pair.id);if(stats){await updatePair(pair.id,{games_won:stats.gamesWon,sets_won:stats.setsWon,points:stats.points,matches_played:stats.matchesPlayed});console.log(`📊 Pareja ${pair.id}: ${stats.points} puntos, ${stats.setsWon} sets, ${stats.gamesWon} juegos, ${stats.matchesPlayed} partidos`);}}console.log(`✅ Estadísticas recalculadas para ${processedMatches} partidos`);console.log(\"🔄 === FIN RECÁLCULO COMPLETO ===\");return{success:true,message:`✅ Estadísticas recalculadas exitosamente para ${processedMatches} partidos`};}catch(error){console.error(\"❌ Error en recalculateAllStatistics:\",error);return{success:false,message:\"Error al recalcular estadísticas del torneo\"};}}/**\n   * Calcula el ranking de las parejas\n   */static calculateRanking(pairs){return[...pairs].sort((a,b)=>{// Criterio 1: Puntos totales (descendente) - CRITERIO PRINCIPAL\nif(a.points!==b.points){return b.points-a.points;}// Criterio 2: Sets ganados (descendente) - CRITERIO DE DESEMPATE\nif(a.sets_won!==b.sets_won){return b.sets_won-a.sets_won;}// Criterio 3: Juegos ganados (descendente)\nif(a.games_won!==b.games_won){return b.games_won-a.games_won;}// Criterio 4: Menos partidos jugados (mejor eficiencia)\nreturn a.matches_played-b.matches_played;});}}","map":{"version":3,"names":["updatePair","getPairs","getMatches","getGames","MatchResultCalculator","calculateMatchStatistics","match","games","console","log","id","length","pair1GamesWon","pair2GamesWon","pair1TotalPoints","pair2TotalPoints","pair1SetsWon","pair2SetsWon","forEach","game","index","pair1_games","pair2_games","is_tie_break","tie_break_pair1","tie_break_pair1_points","tie_break_pair2","tie_break_pair2_points","isTie","recalculateMatchStatistics","pairs","stats","pair1","find","p","pair1_id","pair2","pair2_id","winnerId","undefined","message","_pair1$player","_pair1$player2","_pair2$player","_pair2$player2","winnerName","player1","name","player2","success","pair1Stats","gamesWon","setsWon","points","pair2Stats","error","accumulateMatchStatistics","_pair1$player3","_pair1$player4","games_won","sets_won","matches_played","_pair2$player3","_pair2$player4","_pair1$player5","_pair1$player6","_pair2$player5","_pair2$player6","recalculateAllStatistics","tournamentId","matches","pair","pairStats","Map","set","matchesPlayed","processedMatches","is_finished","get","calculateRanking","sort","a","b"],"sources":["/Users/nedev/padel-tournament-app/src/components/MatchResultCalculator.tsx"],"sourcesContent":["import { Game, Match, Pair } from \"../lib/database\";\nimport { updatePair, getPairs, getMatches, getGames } from \"../lib/database\";\n\nexport interface MatchResult {\n  success: boolean;\n  message: string;\n  pair1Stats: {\n    gamesWon: number;\n    setsWon: number;\n    points: number;\n  };\n  pair2Stats: {\n    gamesWon: number;\n    setsWon: number;\n    points: number;\n  };\n  winnerId?: string;\n  isTie: boolean;\n}\n\nexport class MatchResultCalculator {\n  /**\n   * Calcula estadísticas de un partido específico\n   */\n  static calculateMatchStatistics(\n    match: Match,\n    games: Game[]\n  ): {\n    pair1GamesWon: number;\n    pair2GamesWon: number;\n    pair1SetsWon: number;\n    pair2SetsWon: number;\n    pair1TotalPoints: number;\n    pair2TotalPoints: number;\n    isTie: boolean;\n  } {\n    console.log(\"🎯 === CÁLCULO DE ESTADÍSTICAS DEL PARTIDO ===\");\n    console.log(\"🎯 Partido ID:\", match.id);\n    console.log(\"🎯 Total de juegos:\", games.length);\n\n    let pair1GamesWon = 0;\n    let pair2GamesWon = 0;\n    let pair1TotalPoints = 0;\n    let pair2TotalPoints = 0;\n    let pair1SetsWon = 0;\n    let pair2SetsWon = 0;\n\n    // Procesar cada juego del partido\n    games.forEach((game, index) => {\n      console.log(`📊 === JUEGO ${index + 1} ===`);\n      console.log(\"📊 Datos del juego:\", {\n        pair1_games: game.pair1_games,\n        pair2_games: game.pair2_games,\n        is_tie_break: game.is_tie_break,\n        tie_break_pair1: game.tie_break_pair1_points,\n        tie_break_pair2: game.tie_break_pair2_points,\n      });\n\n      if (game.is_tie_break) {\n        console.log(\"📊 Es un tie-break\");\n        // Para tie-breaks\n        if (game.tie_break_pair1_points > game.tie_break_pair2_points) {\n          pair1GamesWon++;\n          console.log(\n            `✅ Pareja 1 gana tie-break: ${game.tie_break_pair1_points}-${game.tie_break_pair2_points}`\n          );\n        } else if (game.tie_break_pair2_points > game.tie_break_pair1_points) {\n          pair2GamesWon++;\n          console.log(\n            `✅ Pareja 2 gana tie-break: ${game.tie_break_pair1_points}-${game.tie_break_pair2_points}`\n          );\n        } else {\n          console.log(\n            `🤝 Empate en tie-break: ${game.tie_break_pair1_points}-${game.tie_break_pair2_points}`\n          );\n        }\n        pair1TotalPoints += game.tie_break_pair1_points || 0;\n        pair2TotalPoints += game.tie_break_pair2_points || 0;\n      } else {\n        console.log(\"📊 Es un juego normal\");\n        console.log(\n          `📊 Puntos Pareja 1: ${game.pair1_games}, Puntos Pareja 2: ${game.pair2_games}`\n        );\n\n        // Para juegos normales\n        if (game.pair1_games > game.pair2_games) {\n          pair1GamesWon++;\n          console.log(\n            `✅ Pareja 1 gana juego: ${game.pair1_games}-${game.pair2_games}`\n          );\n        } else if (game.pair2_games > game.pair1_games) {\n          pair2GamesWon++;\n          console.log(\n            `✅ Pareja 2 gana juego: ${game.pair1_games}-${game.pair2_games}`\n          );\n        } else {\n          console.log(\n            `🤝 Empate en juego: ${game.pair1_games}-${game.pair2_games}`\n          );\n        }\n        pair1TotalPoints += game.pair1_games;\n        pair2TotalPoints += game.pair2_games;\n      }\n\n      // Verificar si alguna pareja llegó a 6 puntos en este juego (gana 1 set)\n      if (!game.is_tie_break) {\n        if (game.pair1_games >= 6) {\n          pair1SetsWon++;\n          console.log(\n            `🏆 Pareja 1 gana 1 SET en juego ${index + 1} con ${\n              game.pair1_games\n            } puntos`\n          );\n        }\n        if (game.pair2_games >= 6) {\n          pair2SetsWon++;\n          console.log(\n            `🏆 Pareja 2 gana 1 SET en juego ${index + 1} con ${\n              game.pair2_games\n            } puntos`\n          );\n        }\n      }\n\n      console.log(\n        `📊 Después del juego ${\n          index + 1\n        }: Pareja 1 = ${pair1GamesWon} juegos, Pareja 2 = ${pair2GamesWon} juegos`\n      );\n    });\n\n    console.log(\"🔍 === RESULTADO FINAL DEL PARTIDO ===\");\n    console.log(\n      `🔍 Juegos: Pareja 1 = ${pair1GamesWon}, Pareja 2 = ${pair2GamesWon}`\n    );\n    console.log(\n      `🔍 Sets: Pareja 1 = ${pair1SetsWon}, Pareja 2 = ${pair2SetsWon}`\n    );\n    console.log(\n      `🔍 Puntos totales: Pareja 1 = ${pair1TotalPoints}, Pareja 2 = ${pair2TotalPoints}`\n    );\n\n    // Determinar si es empate (cuando los puntos totales son iguales)\n    const isTie = pair1TotalPoints === pair2TotalPoints;\n    console.log(\n      `🔍 Es empate: ${isTie} (${pair1TotalPoints}-${pair2TotalPoints} puntos totales)`\n    );\n\n    console.log(\"🎯 === FIN CÁLCULO DEL PARTIDO ===\");\n\n    return {\n      pair1GamesWon,\n      pair2GamesWon,\n      pair1SetsWon,\n      pair2SetsWon,\n      pair1TotalPoints,\n      pair2TotalPoints,\n      isTie,\n    };\n  }\n\n  /**\n   * SOLO recalcula estadísticas del partido (sin acumular)\n   * Se usa cuando se corrige un juego\n   */\n  static async recalculateMatchStatistics(\n    match: Match,\n    games: Game[],\n    pairs: Pair[]\n  ): Promise<MatchResult> {\n    try {\n      console.log(\"🔄 === RECÁLCULO DE ESTADÍSTICAS DEL PARTIDO ===\");\n      console.log(\"🔄 SOLO recálculo - NO acumula estadísticas\");\n\n      const stats = this.calculateMatchStatistics(match, games);\n      const pair1 = pairs.find((p) => p.id === match.pair1_id);\n      const pair2 = pairs.find((p) => p.id === match.pair2_id);\n\n      console.log(\"📊 Estadísticas recalculadas del partido:\", {\n        pair1GamesWon: stats.pair1GamesWon,\n        pair2GamesWon: stats.pair2GamesWon,\n        pair1SetsWon: stats.pair1SetsWon,\n        pair2SetsWon: stats.pair2SetsWon,\n        isTie: stats.isTie,\n      });\n\n      // NO actualizar estadísticas en la base de datos\n      // Solo calcular para mostrar en la interfaz\n      console.log(\n        \"✅ Solo recálculo completado - NO se actualizaron estadísticas\"\n      );\n\n      // Determinar ganador del partido\n      let winnerId: string | undefined;\n\n      console.log(\"🏆 === DETERMINACIÓN DEL GANADOR DEL PARTIDO ===\");\n      console.log(\n        `🏆 Sets: Pareja 1 = ${stats.pair1SetsWon}, Pareja 2 = ${stats.pair2SetsWon}`\n      );\n      console.log(\n        `🏆 Juegos: Pareja 1 = ${stats.pair1GamesWon}, Pareja 2 = ${stats.pair2GamesWon}`\n      );\n      console.log(`🏆 Es empate: ${stats.isTie}`);\n\n      if (stats.isTie) {\n        winnerId = undefined;\n        console.log(\"🤝 Partido terminó en EMPATE por puntos totales\");\n      } else if (stats.pair1TotalPoints > stats.pair2TotalPoints) {\n        winnerId = match.pair1_id;\n        console.log(\"🏆 Pareja 1 gana por puntos totales\");\n      } else if (stats.pair2TotalPoints > stats.pair1TotalPoints) {\n        winnerId = match.pair2_id;\n        console.log(\"🏆 Pareja 2 gana por puntos totales\");\n      } else {\n        winnerId = undefined;\n        console.log(\"❌ Caso inesperado en determinación del ganador\");\n      }\n\n      let message: string;\n      if (stats.isTie) {\n        message = `✅ Partido recalculado.\\n\\n🤝 EMPATE (${stats.pair1TotalPoints}-${stats.pair2TotalPoints} puntos totales)`;\n      } else if (winnerId) {\n        const winnerName =\n          winnerId === match.pair1_id\n            ? `${pair1?.player1?.name} y ${pair1?.player2?.name}`\n            : `${pair2?.player1?.name} y ${pair2?.player2?.name}`;\n        message = `✅ Partido recalculado.\\n\\n🏆 Ganador: ${winnerName} (${stats.pair1TotalPoints}-${stats.pair2TotalPoints} puntos totales)`;\n      } else {\n        message = `✅ Partido recalculado.\\n\\n🤝 Empate (${stats.pair1TotalPoints}-${stats.pair2TotalPoints} puntos totales)`;\n      }\n\n      console.log(\"🔄 === FIN RECÁLCULO DEL PARTIDO ===\");\n\n      return {\n        success: true,\n        message,\n        pair1Stats: {\n          gamesWon: stats.pair1GamesWon,\n          setsWon: stats.pair1SetsWon,\n          points: stats.pair1TotalPoints,\n        },\n        pair2Stats: {\n          gamesWon: stats.pair2GamesWon,\n          setsWon: stats.pair2SetsWon,\n          points: stats.pair2TotalPoints,\n        },\n        winnerId,\n        isTie: stats.isTie,\n      };\n    } catch (error) {\n      console.error(\"❌ Error en recalculateMatchStatistics:\", error);\n      return {\n        success: false,\n        message: \"Error al recalcular estadísticas del partido\",\n        pair1Stats: { gamesWon: 0, setsWon: 0, points: 0 },\n        pair2Stats: { gamesWon: 0, setsWon: 0, points: 0 },\n        isTie: false,\n      };\n    }\n  }\n\n  /**\n   * ACUMULA estadísticas del partido a las estadísticas totales\n   * Se usa SOLO cuando se finaliza el partido\n   */\n  static async accumulateMatchStatistics(\n    match: Match,\n    games: Game[],\n    pairs: Pair[]\n  ): Promise<MatchResult> {\n    try {\n      console.log(\"🏆 === ACUMULACIÓN DE ESTADÍSTICAS DEL PARTIDO ===\");\n      console.log(\"🏆 ACUMULANDO estadísticas al finalizar partido\");\n\n      const stats = this.calculateMatchStatistics(match, games);\n      const pair1 = pairs.find((p) => p.id === match.pair1_id);\n      const pair2 = pairs.find((p) => p.id === match.pair2_id);\n\n      console.log(\"📊 Estadísticas del partido a acumular:\", {\n        pair1GamesWon: stats.pair1GamesWon,\n        pair2GamesWon: stats.pair2GamesWon,\n        pair1SetsWon: stats.pair1SetsWon,\n        pair2SetsWon: stats.pair2SetsWon,\n        isTie: stats.isTie,\n      });\n\n      // ACUMULAR estadísticas en la base de datos\n      if (pair1) {\n        console.log(\n          `📊 Acumulando Pareja 1: ${pair1.player1?.name} y ${pair1.player2?.name}`\n        );\n        console.log(\n          `📊 Estadísticas actuales: ${pair1.games_won} juegos, ${pair1.sets_won} sets, ${pair1.points} puntos, ${pair1.matches_played} partidos`\n        );\n        console.log(\n          `📊 Estadísticas del partido: ${stats.pair1GamesWon} juegos, ${stats.pair1SetsWon} sets, ${stats.pair1TotalPoints} puntos`\n        );\n\n        await updatePair(pair1.id, {\n          games_won: pair1.games_won + stats.pair1GamesWon,\n          sets_won: pair1.sets_won + stats.pair1SetsWon,\n          points: pair1.points + stats.pair1TotalPoints,\n          matches_played: pair1.matches_played + 1,\n        });\n\n        console.log(\n          `✅ Pareja 1 acumulada: ${\n            pair1.games_won + stats.pair1GamesWon\n          } juegos, ${pair1.sets_won + stats.pair1SetsWon} sets, ${\n            pair1.points + stats.pair1TotalPoints\n          } puntos, ${pair1.matches_played + 1} partidos`\n        );\n      }\n\n      if (pair2) {\n        console.log(\n          `📊 Acumulando Pareja 2: ${pair2.player1?.name} y ${pair2.player2?.name}`\n        );\n        console.log(\n          `📊 Estadísticas actuales: ${pair2.games_won} juegos, ${pair2.sets_won} sets, ${pair2.points} puntos, ${pair2.matches_played} partidos`\n        );\n        console.log(\n          `📊 Estadísticas del partido: ${stats.pair2GamesWon} juegos, ${stats.pair2SetsWon} sets, ${stats.pair2TotalPoints} puntos`\n        );\n\n        await updatePair(pair2.id, {\n          games_won: pair2.games_won + stats.pair2GamesWon,\n          sets_won: pair2.sets_won + stats.pair2SetsWon,\n          points: pair2.points + stats.pair2TotalPoints,\n          matches_played: pair2.matches_played + 1,\n        });\n\n        console.log(\n          `✅ Pareja 2 acumulada: ${\n            pair2.games_won + stats.pair2GamesWon\n          } juegos, ${pair2.sets_won + stats.pair2SetsWon} sets, ${\n            pair2.points + stats.pair2TotalPoints\n          } puntos, ${pair2.matches_played + 1} partidos`\n        );\n      }\n\n      // Determinar ganador\n      let winnerId: string | undefined;\n\n      console.log(\"🏆 === DETERMINACIÓN DEL GANADOR ===\");\n      console.log(\n        `🏆 Sets: Pareja 1 = ${stats.pair1SetsWon}, Pareja 2 = ${stats.pair2SetsWon}`\n      );\n      console.log(\n        `🏆 Juegos: Pareja 1 = ${stats.pair1GamesWon}, Pareja 2 = ${stats.pair2GamesWon}`\n      );\n      console.log(`🏆 Es empate: ${stats.isTie}`);\n\n      if (stats.isTie) {\n        winnerId = undefined;\n        console.log(\"🤝 Partido terminó en EMPATE por puntos totales\");\n      } else if (stats.pair1TotalPoints > stats.pair2TotalPoints) {\n        winnerId = match.pair1_id;\n        console.log(\"🏆 Pareja 1 gana por puntos totales\");\n      } else if (stats.pair2TotalPoints > stats.pair1TotalPoints) {\n        winnerId = match.pair2_id;\n        console.log(\"🏆 Pareja 2 gana por puntos totales\");\n      } else {\n        winnerId = undefined;\n        console.log(\"❌ Caso inesperado en determinación del ganador\");\n      }\n\n      let message: string;\n      if (stats.isTie) {\n        message = `✅ Partido finalizado.\\n\\n🤝 EMPATE (${stats.pair1TotalPoints}-${stats.pair2TotalPoints} puntos totales)`;\n      } else if (winnerId) {\n        const winnerName =\n          winnerId === match.pair1_id\n            ? `${pair1?.player1?.name} y ${pair1?.player2?.name}`\n            : `${pair2?.player1?.name} y ${pair2?.player2?.name}`;\n        message = `✅ Partido finalizado.\\n\\n🏆 Ganador: ${winnerName} (${stats.pair1TotalPoints}-${stats.pair2TotalPoints} puntos totales)`;\n      } else {\n        message = `✅ Partido finalizado.\\n\\n🤝 Empate (${stats.pair1TotalPoints}-${stats.pair2TotalPoints} puntos totales)`;\n      }\n\n      console.log(\"🏆 === FIN ACUMULACIÓN DEL PARTIDO ===\");\n\n      return {\n        success: true,\n        message,\n        pair1Stats: {\n          gamesWon: stats.pair1GamesWon,\n          setsWon: stats.pair1SetsWon,\n          points: stats.pair1TotalPoints,\n        },\n        pair2Stats: {\n          gamesWon: stats.pair2GamesWon,\n          setsWon: stats.pair2SetsWon,\n          points: stats.pair2TotalPoints,\n        },\n        winnerId,\n        isTie: stats.isTie,\n      };\n    } catch (error) {\n      console.error(\"❌ Error en accumulateMatchStatistics:\", error);\n      return {\n        success: false,\n        message: \"Error al acumular estadísticas del partido\",\n        pair1Stats: { gamesWon: 0, setsWon: 0, points: 0 },\n        pair2Stats: { gamesWon: 0, setsWon: 0, points: 0 },\n        isTie: false,\n      };\n    }\n  }\n\n  /**\n   * Recalcula todas las estadísticas del torneo\n   */\n  static async recalculateAllStatistics(tournamentId: string): Promise<{\n    success: boolean;\n    message: string;\n  }> {\n    try {\n      console.log(\"🔄 === INICIO RECÁLCULO COMPLETO ===\");\n\n      // Obtener todos los datos del torneo\n      const pairs = await getPairs(tournamentId);\n      const matches = await getMatches(tournamentId);\n\n      // Resetear todas las estadísticas de las parejas\n      console.log(\"🔄 Reseteando estadísticas de todas las parejas...\");\n      for (const pair of pairs) {\n        await updatePair(pair.id, {\n          games_won: 0,\n          sets_won: 0,\n          points: 0,\n          matches_played: 0,\n        });\n      }\n\n      // Crear un mapa para acumular estadísticas de cada pareja\n      const pairStats = new Map<\n        string,\n        {\n          gamesWon: number;\n          setsWon: number;\n          points: number;\n          matchesPlayed: number;\n        }\n      >();\n\n      // Inicializar estadísticas para todas las parejas\n      for (const pair of pairs) {\n        pairStats.set(pair.id, {\n          gamesWon: 0,\n          setsWon: 0,\n          points: 0,\n          matchesPlayed: 0,\n        });\n      }\n\n      // Procesar cada partido finalizado y acumular estadísticas\n      let processedMatches = 0;\n      for (const match of matches) {\n        if (match.is_finished) {\n          console.log(`🔄 Procesando partido finalizado: ${match.id}`);\n          const games = await getGames(match.id);\n\n          if (games.length > 0) {\n            const stats = this.calculateMatchStatistics(match, games);\n\n            // Acumular estadísticas para pareja 1\n            const pair1Stats = pairStats.get(match.pair1_id)!;\n            pair1Stats.gamesWon += stats.pair1GamesWon;\n            pair1Stats.setsWon += stats.pair1SetsWon;\n            pair1Stats.points += stats.pair1TotalPoints;\n            pair1Stats.matchesPlayed += 1;\n\n            // Acumular estadísticas para pareja 2\n            const pair2Stats = pairStats.get(match.pair2_id)!;\n            pair2Stats.gamesWon += stats.pair2GamesWon;\n            pair2Stats.setsWon += stats.pair2SetsWon;\n            pair2Stats.points += stats.pair2TotalPoints;\n            pair2Stats.matchesPlayed += 1;\n\n            processedMatches++;\n          }\n        }\n      }\n\n      // Actualizar todas las parejas con sus estadísticas acumuladas\n      console.log(\"🔄 Actualizando estadísticas acumuladas...\");\n      for (const pair of pairs) {\n        const stats = pairStats.get(pair.id);\n        if (stats) {\n          await updatePair(pair.id, {\n            games_won: stats.gamesWon,\n            sets_won: stats.setsWon,\n            points: stats.points,\n            matches_played: stats.matchesPlayed,\n          });\n          console.log(\n            `📊 Pareja ${pair.id}: ${stats.points} puntos, ${stats.setsWon} sets, ${stats.gamesWon} juegos, ${stats.matchesPlayed} partidos`\n          );\n        }\n      }\n\n      console.log(\n        `✅ Estadísticas recalculadas para ${processedMatches} partidos`\n      );\n      console.log(\"🔄 === FIN RECÁLCULO COMPLETO ===\");\n\n      return {\n        success: true,\n        message: `✅ Estadísticas recalculadas exitosamente para ${processedMatches} partidos`,\n      };\n    } catch (error) {\n      console.error(\"❌ Error en recalculateAllStatistics:\", error);\n      return {\n        success: false,\n        message: \"Error al recalcular estadísticas del torneo\",\n      };\n    }\n  }\n\n  /**\n   * Calcula el ranking de las parejas\n   */\n  static calculateRanking(pairs: Pair[]): Pair[] {\n    return [...pairs].sort((a, b) => {\n      // Criterio 1: Puntos totales (descendente) - CRITERIO PRINCIPAL\n      if (a.points !== b.points) {\n        return b.points - a.points;\n      }\n      // Criterio 2: Sets ganados (descendente) - CRITERIO DE DESEMPATE\n      if (a.sets_won !== b.sets_won) {\n        return b.sets_won - a.sets_won;\n      }\n      // Criterio 3: Juegos ganados (descendente)\n      if (a.games_won !== b.games_won) {\n        return b.games_won - a.games_won;\n      }\n      // Criterio 4: Menos partidos jugados (mejor eficiencia)\n      return a.matches_played - b.matches_played;\n    });\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}